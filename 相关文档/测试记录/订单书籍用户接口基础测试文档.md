# 校园二手书平台 - 订单模块核心接口测试文档
## 一、测试概述
### 1. 测试对象
校园二手书平台订单相关核心接口（含用户登录、订单创建、订单列表查询、订单状态更新），验证接口功能正确性、数据一致性及业务逻辑合规性。

### 2. 测试目的
- 确认用户登录后可正常执行订单相关操作；
- 验证订单创建、列表查询、状态更新的核心流程无异常；
- 确保订单状态流转（待支付→已支付）符合业务规则，数据关联准确。

### 3. 测试环境
| 环境类型 | 具体信息 |
|----------|----------|
| 后端服务地址 | http://127.0.0.1:5000 |
| 技术栈 | 后端：Python Flask + MySQL；身份验证：Session |
| 测试工具 | Postman（接口请求发送）、MySQL客户端（数据校验辅助） |


## 二、测试用例详情（共4条，均通过）
### 用例1：用户登录接口（POST /user/login）
#### 基本信息
- **用例ID**：UC-001  
- **测试模块**：用户模块  
- **测试目的**：验证已注册用户可正常登录，获取有效登录态  
- **前置条件**：用户已注册（手机号：13812345678；密码：Test@123；用户名：图书卖家01）  

#### 测试步骤
1. 打开测试工具，选择请求方式为**POST**，输入接口路由：`http://127.0.0.1:5000/user/login`；  
2. 在「Body」中选择「raw→JSON」，传入登录参数；  
3. 点击「发送」，查看响应结果及登录态（Session）是否正常。

#### 请求信息
- **请求方式**：POST  
- **请求路由**：/user/login  
- **请求参数（JSON）**：
  ```json
  {
    "phone": "13812345678",
    "password": "Test@123"
  }
  ```

#### 预期结果
1. 响应状态码：200；  
2. 响应体包含「登录成功」提示，返回用户ID、手机号、用户名；  
3. 登录态（Session）有效，后续需登录接口可正常调用。

#### 实际结果
- 响应状态码：200  
- 响应体：
  ```json
  {
    "code": 200,
    "data": {
        "user": {
            "id": 2,
            "phone": "13812345678",
            "username": "图书卖家01"
        }
    },
    "msg": "登录成功"
  }
  ```
- 登录态正常，后续订单接口可携带Session执行操作。

#### 测试结论
用例通过，用户登录功能正常，登录态有效。


### 用例2：创建订单接口（POST /order/create）
#### 基本信息
- **用例ID**：OC-001  
- **测试模块**：订单模块  
- **测试目的**：验证已登录买家可正常创建订单，书籍状态同步更新为“已售出”  
- **前置条件**：
  1. 用例1已执行，用户（ID=2，用户名=图书卖家01）处于登录状态；  
  2. 书籍ID=2（书名：《线性代数（第六版）》）存在且状态为“在售”（status=1），卖家ID=1（用户名=测试买家）。

#### 测试步骤
1. 测试工具保持登录态（继承用例1的Session），选择请求方式为**POST**，输入路由：`http://127.0.0.1:5000/order/create`；  
2. 「Body→raw→JSON」传入书籍ID参数；  
3. 点击「发送」，查看响应结果；  
4. （辅助校验）通过MySQL客户端查看`books`表，确认书籍ID=2的状态是否更新为“已售出”（status=0）。

#### 请求信息
- **请求方式**：POST  
- **请求路由**：/order/create  
- **请求参数（JSON）**：
  ```json
  {
    "book_id": 2
  }
  ```

#### 预期结果
1. 响应状态码：200；  
2. 响应体包含「订单创建成功」提示，返回订单详情（含订单号、买家ID、卖家ID、书籍信息，初始状态=1（待支付））；  
3. 数据库中书籍ID=2的`status`字段更新为0（已售出）。

#### 实际结果
- 响应状态码：200  
- 响应体：
  ```json
  {
    "code": 200,
    "data": {
        "book_id": 2,
        "book_title": "线性代数（第六版）",
        "buyer_id": 2,
        "buyer_name": "图书卖家01",
        "create_time": "2025-10-25 00:11",
        "id": 2,
        "order_no": "176132231721781",
        "price": 18.9,
        "seller_id": 1,
        "seller_name": "测试买家",
        "status": 1,
        "status_text": "待支付"
    },
    "msg": "订单创建成功"
  }
  ```
- 辅助校验：`books`表中书籍ID=2的`status`更新为0，符合预期。

#### 测试结论
用例通过，订单创建功能正常，书籍状态同步更新。


### 用例3：查询买家订单列表接口（GET /order/list?role=buyer）
#### 基本信息
- **用例ID**：OL-001  
- **测试模块**：订单模块  
- **测试目的**：验证已登录买家可查询自己的所有订单，数据关联准确  
- **前置条件**：
  1. 用例2已执行，用户（ID=2）已创建订单（ID=2）；  
  2. 用户（ID=2）历史存在1条已支付订单（ID=1，书籍ID=1）。

#### 测试步骤
1. 保持登录态，选择请求方式为**GET**，输入接口路由：`http://127.0.0.1:5000/order/list?role=buyer`；  
2. 无需额外请求体，直接点击「发送」；  
3. 查看响应结果，确认订单列表是否包含用户ID=2作为买家的所有订单。

#### 请求信息
- **请求方式**：GET  
- **请求路由**：/order/list?role=buyer  
- **请求参数**：通过URL Query传递`role=buyer`（指定买家视角）

#### 预期结果
1. 响应状态码：200；  
2. 响应体返回`orders`数组，包含用户ID=2的所有买家订单（共2条：ID=1、ID=2）；  
3. 每条订单包含完整关联信息（书籍标题、卖家用户名、订单状态文本），`total`字段等于2。

#### 实际结果
- 响应状态码：200  
- 响应体：
  ```json
  {
    "code": 200,
    "data": {
        "orders": [
            {
                "book_id": 2,
                "book_title": "线性代数（第六版）",
                "buyer_id": 2,
                "buyer_name": "图书卖家01",
                "create_time": "2025-10-25 00:11",
                "id": 2,
                "order_no": "176132231721781",
                "price": 18.9,
                "seller_id": 1,
                "seller_name": "测试买家",
                "status": 1,
                "status_text": "待支付"
            },
            {
                "book_id": 1,
                "book_title": "线性代数（第六版）",
                "buyer_id": 2,
                "buyer_name": "图书卖家01",
                "create_time": "2025-10-25 00:06",
                "id": 1,
                "order_no": "176132198728992",
                "price": 18.9,
                "seller_id": 1,
                "seller_name": "测试买家",
                "status": 2,
                "status_text": "已支付"
            }
        ],
        "total": 2
    }
  }
  ```

#### 测试结论
用例通过，买家订单列表查询功能正常，数据关联完整、数量准确。


### 用例4：更新订单状态接口（POST /order/<order_id>/update）
#### 基本信息
- **用例ID**：OS-001  
- **测试模块**：订单模块  
- **测试目的**：验证买家可将订单状态从“待支付”（1）更新为“已支付”（2），状态流转合规  
- **前置条件**：
  1. 用例2已执行，订单ID=2的当前状态为1（待支付）；  
  2. 用户（ID=2）处于登录状态，且为订单ID=2的买家（有权限更新支付状态）。

#### 测试步骤
1. 保持登录态，选择请求方式为**POST**，输入接口路由：`http://127.0.0.1:5000/order/2/update`（`order_id=2`为目标订单ID）；  
2. 「Body→raw→JSON」传入目标状态参数；  
3. 点击「发送」，查看响应结果；  
4. （辅助校验）调用订单列表接口（用例3），确认订单ID=2的状态已更新为2。

#### 请求信息
- **请求方式**：POST  
- **请求路由**：/order/2/update  
- **请求参数（JSON）**：
  ```json
  {
    "status": 2
  }
  ```

#### 预期结果
1. 响应状态码：200；  
2. 响应体包含「订单状态更新成功」提示，返回订单ID=2的最新信息（status=2，status_text=已支付）；  
3. 订单列表中订单ID=2的状态同步更新为2。

#### 实际结果
- 响应状态码：200  
- 响应体：
  ```json
  {
    "code": 200,
    "data": {
        "book_id": 2,
        "book_title": "线性代数（第六版）",
        "buyer_id": 2,
        "buyer_name": "图书卖家01",
        "create_time": "2025-10-25 00:11",
        "id": 2,
        "order_no": "176132231721781",
        "price": 18.9,
        "seller_id": 1,
        "seller_name": "测试买家",
        "status": 2,
        "status_text": "已支付"
    },
    "msg": "订单状态更新成功"
  }
  ```
- 辅助校验：调用`/order/list?role=buyer`，订单ID=2的`status`已更新为2，符合预期。

#### 测试结论
用例通过，订单状态流转（待支付→已支付）合规，权限校验正常。


## 三、测试结果总结
### 1. 整体结果
本次测试共执行4条核心用例，覆盖“登录→创建订单→查询订单→更新状态”的完整流程，**所有用例均通过**，无功能异常或数据不一致问题。

### 2. 核心验证点确认
| 验证点 | 结果 | 说明 |
|--------|------|------|
| 用户登录态有效性 | 正常 | 登录后Session有效，可支撑后续订单操作 |
| 订单创建数据关联 | 准确 | 订单与买家、卖家、书籍的ID关联正确，书籍状态同步更新 |
| 订单列表角色过滤 | 正确 | 买家视角仅返回自己的订单，无数据越权 |
| 订单状态流转合规 | 合规 | 仅买家可更新支付状态，无跳级流转（如待支付→已收货） |

### 3. 后续可补充测试
- 可补充测试“已支付→已发货”“已发货→已收货”等后续状态流转；  
- 建议增加异常场景测试（如非买家更新支付状态、订单不存在时更新），进一步验证接口鲁棒性。